resources:
- name: evening-time
  type: time
  icon: clock
  source:
    start: 20:00
    stop: 20:05
    location: Europe/London

jobs:
- name: scambs-bins-job
  plan:
  - get: evening-time
    trigger: true

  - task: scambs-check-bin-calendar
    config:
      platform: linux
      image_resource:
        type: registry-image
        source:
          repository: frostvoid/scambs-bins
          tag: latest
      outputs:
        - name: result
      run:
        path: /bin/bash
        args:
          - -c
          - |
            pushd /app
            sbt -error run > output.txt
            popd
            cp /app/output.txt result

  - task: notify-via-homeassistant-webhook
    config:
      platform: linux
      image_resource:
        type: registry-image
        source:
          repository: alpine/curl
      inputs:
        - name: result
      run:
        path: /bin/sh
        args:
        - -cx
        - |
          data=`cat ./result/output.txt`
          if [[ data ]]; then
            echo "Data: $data" ; exit
            exit 0
          else
            echo "NOT SET"
            exit 1
          fi
#curl home assistant with output.text IF file is not empty TODO test with empty